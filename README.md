# mime-email

constructs a MIME-formatted email message from command-line options and an optional body file.

The resulting message is written to standard output.

This command is written as a BASH script.

## Example

```sh
echo "hello mime-email" \
    | mime-email \
         --from "me@example.com" \
         --to "John Smith a@example.com" \
         --to "b@example.com" \
         --subject "test mail" \
         --attach README.md \
    | msmtp -v -t
```

## Description

`mime-email` generates a MIME email message from command line options and an optional body file, and prints it to stdout.

## Address format

`--from`, `--to`, `--cc`, and `--bcc` accept either a plain email address or a display name followed by an email address.

Examples:

```
--from "user@example.com"
--from "John user@example.com"
--from "John Smith user@example.com"
```

If the argument consists of multiple space-separated words, the last word is interpreted as the email address and the preceding words as the display name.
The script automatically encodes the display name and formats the header as:

```
Display Name <address@example.com>
```

## Attachments

Files specified with `--attach` will be included as MIME attachments. The script determines their MIME types using `file` and encodes them with `base64`.

## Subject

The subject is specified with `--subject`. It will be encoded when necessary.

## Date

If not provided, the `Date` header is generated by the system.

## Line Endings (CRLF vs LF)

By default, this tool does **not guarantee CRLF (`\r\n`) line endings** as required by RFC 5322 / 5321.
On most Linux systems, output will use LF (`\n`) line endings.

In practice, **many SMTP servers accept LF-only messages**, so this usually works without issues.

### Enforcing CRLF Line Endings

If strict RFC compliance is required, you can convert line endings to CRLF in one of the following ways.

#### 1. Enable CRLF conversion in the script

Uncomment the following line:

```sh
# exec > >(sed 's/\r*$/\r/')
```

#### 2. Convert in a downstream pipeline

```sh
mime-email ... | sed 's/\r*$/\r/' | msmtp -t
```

### Note

CRLF is rarely required in practice, but may be necessary for strict validation or certain SMTP gateways.

## Dependencies

This script relies on the following external commands:

- `base64`
- `date`
- `file`
- `fold`
- `sed`
- `tr`

## License

MIT License.

---

## Appendix

### install msmtp (for RHEL, rocky9)

```sh
sudo dnf install epel-release
sudo dnf install msmtp
touch ~/.msmtprc
chmod 600 ~/.msmtprc
```


#### write in `~/.msmtprc`

```msmtprc
account default
host mail.example.com
port 465
auth on
from me@example.com
user me
password MyPassword123
tls on
tls_starttls off
tls_trust_file /etc/ssl/certs/ca-bundle.crt
```

